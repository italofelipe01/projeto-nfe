<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Declara√ß√µes de Servi√ßos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon.png') }}">
</head>

<body>

    <div class="container">

        <div class="logo-container">
            <img src="{{ url_for('static', filename='images/logo-ebm.png') }}" alt="Logo EBM">
        </div>

        <h1>Conversor de Declara√ß√µes de Servi√ßos Contratados</h1>
        <p class="subtitle">Prazer em viver assim</p>

        <div id="step-1" class="step show">
            <h2>Etapa 1: Configura√ß√£o e Upload</h2>
            <form id="upload-form">

                <div class="card">
                    <h3>Dados do Tomador (Cabe√ßalho)</h3>
                    <div class="form-grid">

                        <div class="form-group" style="grid-column: span 2;">
                            <label for="config-selector">Selecionar Configura√ß√£o de Tomador</label>
                            <select id="config-selector" name="config_selector" class="config-select">
                                <option value="">-- Selecione uma empresa --</option>

                                {% for config in configurations %}
                                <option value="{{ config.id }}" data-razao="{{ config.razao_social }}"
                                    data-inscricao="{{ config.inscricao_municipal }}">
                                    {{ config.nome_dropdown }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="inscricao_municipal">Inscri√ß√£o Municipal*</label>
                            <input type="text" name="inscricao_municipal" id="inscricao_municipal"
                                placeholder="Selecione uma empresa acima" required>
                        </div>
                        <div class="form-group">
                            <label for="razao_social">Nome/Raz√£o Social do Tomador*</label>
                            <input type="text" name="razao_social" id="razao_social"
                                placeholder="Selecione uma empresa acima" required>
                        </div>

                        <div class="form-group">
                            <label for="mes">M√™s da Compet√™ncia*</label>
                            <input type="number" name="mes" id="mes" placeholder="M√™s (1-12)" min="1" max="12" required>
                        </div>
                        <div class="form-group">
                            <label for="ano">Ano da Compet√™ncia*</label>
                            <input type="number" name="ano" id="ano" placeholder="Ano (AAAA)" min="2000" max="2100"
                                required>
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label for="codigo_servico">C√≥digo do Servi√ßo Contratado*</label>
                            <input type="text" name="codigo_servico" id="codigo_servico" placeholder="C√≥digo do Servi√ßo"
                                required>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Configura√ß√µes de Importa√ß√£o</h3>
                    <div class="form-grid-options">
                        <div class="form-group-radio">
                            <span>Separador decimal usado no seu arquivo:</span>
                            <label>
                                <input type="radio" name="separador_decimal" value="virgula" checked> V√≠rgula (,)
                            </label>
                            <label>
                                <input type="radio" name="separador_decimal" value="ponto"> Ponto (.)
                            </label>
                        </div>
                        <div class="form-group-radio">
                            <span>Possui d√≠gito verificador?</span>
                            <label>
                                <input type="radio" name="digito_verificador" value="sim"> Sim
                            </label>
                            <label>
                                <input type="radio" name="digito_verificador" value="nao" checked> N√£o
                            </label>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Arquivo de Origem</h3>
                    <div class="upload-area" id="upload-area">
                        <input type="file" name="file" id="file-input" accept=".csv,.xlsx" required>
                        <label for="file-input" id="file-label">
                            Clique ou arraste o arquivo (.csv ou .xlsx) aqui
                        </label>
                        <p id="file-name-preview"></p>
                    </div>
                </div>

                <button type="submit" id="convert-btn" class="btn-primary" disabled>Converter</button>
            </form>
        </div>

        <div id="step-2" class="step hide">
            <h2>Etapa 2: Processando Arquivo...</h2>
            <div class="progress-container">
                <p id="status-message">Iniciando convers√£o...</p>
                <div class="progress-bar">
                    <div id="progress-fill" style="width: 0%"></div>
                </div>
                <p id="progress-text">0%</p>
                <p id="progress-details"></p>
            </div>
        </div>

        <div id="step-3" class="step hide">
            <h2>Etapa 3: Convers√£o Conclu√≠da</h2>
            <div class="result-summary card">
                <h3>Resumo da Convers√£o</h3>
                <div class="stats">
                    <p>Total de registros: <span id="total-records">0</span></p>
                    <p class="success-text">Processados com sucesso: <span id="success-records">0</span></p>
                    <p class="error-text">Com erros: <span id="error-records">0</span></p>
                </div>

                <div id="download-section">
                    <button id="download-btn" class="btn-primary">
                        Baixar Arquivo TXT
                    </button>
                </div>
                <div id="rpa-section"
                    style="display:none; margin-top: 20px; border-top: 1px solid #ccc; padding-top: 20px;">
                    <h3>ü§ñ Automa√ß√£o de Envio (RPA)</h3>
                    <p>O arquivo foi gerado. Deseja que o rob√¥ tente enviar para o ISS.net?</p>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="devModeCheck">
                        <label class="form-check-label" for="devModeCheck">
                            Modo Desenvolvedor (Ver o rob√¥ trabalhando na tela - Headful)
                        </label>
                    </div>
                    <br>
                    <button id="btnRunRPA" class="btn btn-warning">üöÄ Executar Envio Autom√°tico</button>

                    <div id="rpa-logs"
                        style="margin-top: 15px; background: #f8f9fa; padding: 10px; border-radius: 5px; display: none;">
                        <strong>Status do Rob√¥:</strong> <span id="rpa-status-text">Aguardando...</span>
                    </div>
                </div>

                <div id="errors-list" class="errors hide">
                    <h4>Detalhes dos Erros</h4>
                    <pre id="errors-content"></pre>
                </div>

                <button id="new-conversion-btn" class="btn-secondary">
                    Converter Novo Arquivo
                </button>
            </div>
        </div>

    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>

</html>